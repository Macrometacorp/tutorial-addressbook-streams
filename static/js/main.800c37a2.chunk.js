(this["webpackJsonpaddressbook-v2"]=this["webpackJsonpaddressbook-v2"]||[]).push([[0],{76:function(e,t,a){},79:function(e,t,a){},84:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a(11),o=a.n(n),i=(a(76),a(38)),r=a(35),c=a(56),l=a(57),d=a(18),u=a(62),h=a(61),m=a(20),p=a.n(m),b=a.p+"static/media/macrometa-white-transparent.c34a418e.png",f=a.p+"static/media/circle_spinner.ba4ecef0.gif",j=a(140),g=a(147),v=a(141),x=a(145),O=a(144),y=a(142),k=a(143),S=a(136),E=a(146),N=a(152),w=a(150),C=a(139),M=a(130),T=a(134),F=a(137),R=a(148),D=a(151),A=a(138),P={global:"gdn.paas.macrometa.io",Fremont:"gdn-us-west.paas.macrometa.io",London:"gdn-eu-west.paas.macrometa.io",Mumbai:"gdn-ap-west.paas.macrometa.io",Singapore:"gdn-ap-south.paas.macrometa.io",Tokyo:"gdn-ap-northeast.paas.macrometa.io",Sydney:"gdn-ap-sydney.paas.macrometa.io"},U=a(60),I=a(58),_=a.n(I),z=function(e,t){return t.reduce((function(t,a){return e===a._key?t:[].concat(Object(U.a)(t),[a])}),[])},H=function(e,t){var a=e._key,s=_.a.cloneDeep(t),n=t.findIndex((function(e){return e._key===a}));return-1===n?s.push(e):s[n]=e,s},L=function(e,t,a){return"wss://api-".concat(e,"/_ws/ws/v2/consumer/persistent/").concat(t,"/c8local.").concat(a,"/addresses/").concat(Math.floor(Math.random()*Math.floor(99999)))},W=function(e,t,a){return"wss://api-".concat(e,"/_ws/ws/v2/producer/persistent/").concat(t,"/c8local.").concat(a,"/addresses")},J=function(e,t,a){return"https://api-".concat(e,"/_tenant/").concat(t,"/_fabric/").concat(a,"/cursor")},Z=(a(79),a(5)),q=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var s,n;return Object(c.a)(this,a),(s=t.call(this,e)).handleFormChange=function(e){return function(t){s.setState(Object(r.a)({},e,t.target.value))}},s.state={shouldShowModal:!1,showSnackbar:!1,isEdit:!1,snackbarText:"",firstName:"",lastName:"",emailAddress:"",firstNameHasError:!1,lastNameHasError:!1,emailAddressHasError:!1,data:[],isLoading:!0,lastEditElem:null,selectedRegionUrl:"",selectedRegionName:"",regionModal:!1,availableRegions:(n=P,Object.keys(n).reduce((function(e,t){var a=t.split("_").reduce((function(e,t){return e+t.toUpperCase()+" "}),""),s={label:a,value:n[t]};return e.push(s),e}),[])),baseUrl:"",wsUrl:"",producerUrl:"",loginModal:!0,email:"demo@macrometa.io",fabric:"_system",password:"demo",wsotp:"",emailRegex:new RegExp(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)},s.onFabPress=s.onFabPress.bind(Object(d.a)(s)),s.getOtp=s.getOtp.bind(Object(d.a)(s)),s.handleFormChange=s.handleFormChange.bind(Object(d.a)(s)),s.onSavePressed=s.onSavePressed.bind(Object(d.a)(s)),s.resetModalData=s.resetModalData.bind(Object(d.a)(s)),s.fetchData=s.fetchData.bind(Object(d.a)(s)),s.onTextInputFocus=s.onTextInputFocus.bind(Object(d.a)(s)),s.onSocketMessageReceived=s.onSocketMessageReceived.bind(Object(d.a)(s)),s.connection=void 0,s.producer=void 0,s.jwtToken=void 0,s.tenant=void 0,s}return Object(l.a)(a,[{key:"componentWillUnmount",value:function(){this.connection.close(),this.producer.close()}},{key:"login",value:function(){var e=this,t=this.state,a=t.email,s=t.password,n=t.selectedRegionUrl,o=this,i={email:a,password:s},r="https://api-".concat(n,"/_open/auth");p.a.ajax({url:r,method:"POST",data:JSON.stringify(i),dataType:"json",success:function(t){var a=t.jwt,s=t.tenant;e.jwtToken=a,e.tenant=s,e.setState({regionModal:!1,baseUrl:J(n,e.tenant,e.state.fabric),wsUrl:L(n,e.tenant,e.state.fabric),producerUrl:W(n,e.tenant,e.state.fabric)},(function(){e.ajaxSetup(),e.initWebSocket();var t=e.createCollection();p.a.when(t).done((function(e){o.sleep(3e4),o.fetchData()})),e.fetchData()}))},error:function(){return e.handleSnackbar("Auth failed.")}})}},{key:"getOtp",value:function(){var e="https://api-".concat(this.state.selectedRegionUrl,"/apid/otp");return p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:e})}},{key:"createCollection",value:function(){var e=this,t=!1,a="https://api-".concat(this.state.selectedRegionUrl,"/_tenant/").concat(this.tenant,"/_fabric/").concat(this.state.fabric,"/collection");return p.a.ajax({type:"GET",contentType:"text/plain",processData:!1,cache:!1,url:a,success:function(a){for(var s=a.result,n=0;n<s.length;n++){if("addresses"===s[n].name){t=!0,console.log("Collection exists");break}t=!1}!1===t&&e.collection()}})}},{key:"sleep",value:function(e,t){return new Promise((function(){return setTimeout(t,e)}))}},{key:"collection",value:function(){var e="https://api-".concat(this.state.selectedRegionUrl,"/_tenant/").concat(this.tenant,"/_fabric/").concat(this.state.fabric,"/collection");p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:e,data:JSON.stringify({name:"addresses"}),success:function(e){console.log("Collection Created")}})}},{key:"ajaxSetup",value:function(){p.a.ajaxSetup({headers:{Authorization:"bearer ".concat(this.jwtToken)}})}},{key:"initWebSocket",value:function(){var e=this;this.getOtp().then((function(t){var a=t.otp,s=e.state.wsUrl;e.connection=new WebSocket("".concat(s,"?otp=").concat(a)),e.connection.onmessage=e.onSocketMessageReceived,e.connection.onopen=function(){return console.log("WS connection established")},e.connection.onerror=function(){return console.log("Failed to establish WS connection")},e.connection.onclose=function(){return console.log("Closing WS connection")}})),this.getOtp().then((function(t){var a=t.otp,s=e.state.producerUrl;e.producer=new WebSocket("".concat(s,"?otp=").concat(a)),e.producer.onopen=function(){setInterval((function(){e.producer.send(JSON.stringify({payload:"noop"}))}),3e4)}}))}},{key:"deleteData",value:function(e){this.setState({data:z(e,this.state.data)})}},{key:"addOrUpdateData",value:function(e){this.setState({data:H(e,this.state.data)})}},{key:"onSocketMessageReceived",value:function(e){var t=JSON.parse(e.data),a={messageId:t.messageId};if(this.connection.send(JSON.stringify(a)),"noop"!==t.payload){var s=JSON.parse(atob(t.payload));s._delete?this.deleteData(s._key):this.addOrUpdateData(s)}}},{key:"fetchData",value:function(e){var t=this,a=this.state.baseUrl;this.setState({isLoading:!0},(function(){p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:a,data:JSON.stringify({query:"FOR entry IN addresses RETURN entry"}),success:function(e){t.state.shouldShowModal||t.resetModalData(),t.setState({isLoading:!1,data:e.result})},error:function(a){e&&t.resetModalData(),t.setState({isLoading:!1}),t.handleSnackbar("Could not fetch data"),console.log("Error:",a)}})}))}},{key:"onFabPress",value:function(){this.setState({shouldShowModal:!0})}},{key:"resetModalData",value:function(){this.setState({lastEditElem:void 0,shouldShowModal:!1,isEdit:!1,firstName:"",lastName:"",emailAddress:"",firstNameHasError:!1,lastNameHasError:!1,emailAddressHasError:!1})}},{key:"validate",value:function(){var e=this.state,t=e.firstName,a=e.lastName,s=e.emailAddress,n={};return this.state.isEdit?this.state.lastEditElem.email.trim()&&this.state.emailRegex.test(this.state.lastEditElem.email.trim())||(n.emailAddressHasError=!0):(t.trim()||(n.firstNameHasError=!0),a.trim()||(n.lastNameHasError=!0),s.trim()&&this.state.emailRegex.test(s.trim())||(n.emailAddressHasError=!0)),n}},{key:"onSavePressed",value:function(){var e=this,t=this.state.baseUrl,a=this.validate();if(0===Object.keys(a).length){var s="Contact details added successfully",n="Contact details could not be added",o=this.state,r=o.firstName,c=o.lastName,l=o.emailAddress,d=o.isEdit,u='INSERT { "firstname":"'.concat(r,'", "lastname":"').concat(c,'", "email":"').concat(l,'" } INTO addresses');if(d){var h=this.state.lastEditElem,m=h._key,b=h.firstname,f=h.lastname,j=h.email;u='UPDATE "'.concat(m,'" WITH { firstname:"').concat(b,'", lastname:"').concat(f,'", email:"').concat(j,'" } IN addresses'),s="Contact details updated successfully",n="Contact details could not be updated"}p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:t,data:JSON.stringify({query:u}),success:function(){e.handleSnackbar(s),e.resetModalData()},error:function(t){e.handleSnackbar(n),e.resetModalData(),console.log("Error:",t)}})}else this.setState(Object(i.a)({},a))}},{key:"onTextInputFocus",value:function(e){this.state["".concat(e,"HasError")]&&this.setState(Object(r.a)({},"".concat(e,"HasError"),!1))}},{key:"onEditPressed",value:function(e){e&&this.setState({shouldShowModal:!0,isEdit:!0,lastEditElem:e})}},{key:"onRemovePressed",value:function(e){var t=this,a=this.state.baseUrl;e&&this.setState({lastEditElem:e},(function(){p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:a,data:JSON.stringify({query:'REMOVE "'.concat(e._key,'" IN addresses')}),success:function(){t.handleSnackbar("Contact details removed successfully"),t.resetModalData()},error:function(e){t.handleSnackbar("Contact details could not be removed"),t.resetModalData(),console.log("Error:",e)}})}))}},{key:"handleSnackbar",value:function(e){var t=this;this.setState({showSnackbar:!0,snackbarText:e},(function(){setTimeout((function(){t.setState({showSnackbar:!1,snackbarText:""})}),2e3)}))}},{key:"renderDialogContent",value:function(){var e=this,t=this.state.lastEditElem||{},a=t.firstname,s=t.lastname,n=t.email;return Object(Z.jsxs)(M.a,{children:[Object(Z.jsx)(T.a,{children:this.state.isEdit?"Fill in the fields to be updated.":"Provide all the details to add a new contact."}),Object(Z.jsx)(g.a,{onFocus:function(){return e.onTextInputFocus("firstName")},required:!this.state.isEdit,error:this.state.firstNameHasError,style:{display:"block"},label:"First Name",inputProps:{maxLength:24},value:this.state.isEdit?a:this.state.firstName,onChange:function(t){if(e.state.isEdit){var a=Object(i.a)({},e.state.lastEditElem);a.firstname=t.target.value,e.setState({lastEditElem:a})}else e.handleFormChange("firstName")(t)},margin:"normal"}),Object(Z.jsx)(g.a,{onFocus:function(){return e.onTextInputFocus("lastName")},required:!this.state.isEdit,error:this.state.lastNameHasError,style:{display:"block"},label:"Last Name",inputProps:{maxLength:24},value:this.state.isEdit?s:this.state.lastName,onChange:function(t){if(e.state.isEdit){var a=Object(i.a)({},e.state.lastEditElem);a.lastname=t.target.value,e.setState({lastEditElem:a})}else e.handleFormChange("lastName")(t)},margin:"normal"}),Object(Z.jsx)(g.a,{onFocus:function(){return e.onTextInputFocus("emailAddress")},required:!0,error:this.state.emailAddressHasError,style:{display:"block"},label:"Email",value:this.state.isEdit?n:this.state.emailAddress,onChange:function(t){if(e.state.isEdit){var a=Object(i.a)({},e.state.lastEditElem);a.email=t.target.value,e.setState({lastEditElem:a})}else e.handleFormChange("emailAddress")(t)},margin:"normal"})]})}},{key:"renderRegionModal",value:function(){var e=this,t=this.state,a=t.regionModal,s=t.availableRegions,n=t.selectedRegionUrl;return Object(Z.jsxs)(w.a,{fullWidth:!0,open:a,children:[Object(Z.jsx)(F.a,{id:"form-dialog-title",children:"Select Region:"}),Object(Z.jsx)(M.a,{children:Object(Z.jsx)(D.a,{onChange:function(t){var a=t.target.value,n=s.find((function(e){return e.value===a})).label;e.setState({selectedRegionUrl:a,selectedRegionName:n})},value:n,children:s.map((function(e){return Object(Z.jsx)(A.a,{value:e.value,control:Object(Z.jsx)(R.a,{}),label:e.label},e.label)}))})}),Object(Z.jsx)(C.a,{children:Object(Z.jsx)(j.a,{disabled:!n,onClick:function(){return e.login()},size:"small",variant:"text",color:"primary",children:Object(Z.jsx)("span",{className:"actions",children:"CONFIRM"})})})]})}},{key:"renderLoginModal",value:function(){var e=this,t=this.state.loginModal;return Object(Z.jsxs)(w.a,{fullWidth:!0,open:t,children:[Object(Z.jsx)(F.a,{id:"form-dialog-title",children:"Please login to your Macrometa account:"}),Object(Z.jsxs)(M.a,{children:[Object(Z.jsx)(g.a,{onFocus:function(){return e.onTextInputFocus("email")},style:{display:"block"},label:"Email",defaultValue:this.state.email,onChange:function(t){var a=t.target.value;e.setState({email:a})},margin:"normal"}),Object(Z.jsx)(g.a,{onFocus:function(){return e.onTextInputFocus("fabric")},style:{display:"block"},label:"Fabric ",defaultValue:this.state.fabric,onChange:function(t){var a=t.target.value;e.setState({fabric:a})},margin:"normal"}),Object(Z.jsx)(g.a,{type:"password",onFocus:function(){return e.onTextInputFocus("password")},style:{display:"block"},label:"Password ",defaultValue:this.state.password,onChange:function(t){var a=t.target.value;e.setState({password:a})},margin:"normal"})]}),Object(Z.jsx)(C.a,{children:Object(Z.jsx)(j.a,{onClick:function(){return e.setState({loginModal:!1,regionModal:!0})},size:"small",variant:"text",color:"primary",children:Object(Z.jsx)("span",{className:"actions",children:"CONFIRM"})})})]})}},{key:"render",value:function(){var e=this,t=this.state,a=t.data,s=t.selectedRegionName;return Object(Z.jsxs)("div",{className:"App",children:[Object(Z.jsxs)("header",{className:"App-header",children:[Object(Z.jsx)("img",{src:b,alt:"logo",style:{height:"100px"}}),Object(Z.jsxs)("h1",{className:"App-title",children:["Address book is connected to ",s]})]}),this.renderLoginModal(),this.renderRegionModal(),Object(Z.jsx)(S.a,{children:Object(Z.jsxs)(v.a,{children:[Object(Z.jsx)(y.a,{children:Object(Z.jsxs)(k.a,{children:[Object(Z.jsx)(O.a,{children:"KEY"}),Object(Z.jsx)(O.a,{children:"First Name"}),Object(Z.jsx)(O.a,{children:"Last Name"}),Object(Z.jsx)(O.a,{children:"Email"}),Object(Z.jsx)(O.a,{style:{paddingLeft:"40px"},children:"Actions"})]})}),Object(Z.jsx)(x.a,{children:a.map((function(t){return Object(Z.jsxs)(k.a,{children:[Object(Z.jsx)(O.a,{component:"th",scope:"row",children:t._key}),Object(Z.jsx)(O.a,{children:t.firstname}),Object(Z.jsx)(O.a,{children:t.lastname}),Object(Z.jsx)(O.a,{children:t.email}),Object(Z.jsx)(O.a,{children:Object(Z.jsxs)("div",{children:[Object(Z.jsx)(j.a,{onClick:function(){e.onEditPressed(t)},size:"small",variant:"text",color:"primary",children:Object(Z.jsx)("span",{style:{fontSize:"10px"},children:"Edit"})}),Object(Z.jsx)(j.a,{onClick:function(){e.onRemovePressed(t)},size:"small",variant:"text",color:"secondary",children:Object(Z.jsx)("span",{style:{fontSize:"10px"},children:"Remove"})})]})})]},t._key)}))})]})}),Object(Z.jsx)(E.a,{onClick:this.onFabPress,style:{position:"fixed",bottom:"70px",right:"70px"},size:"large",color:"primary",children:Object(Z.jsx)("span",{style:{fontSize:"30px"},children:"+"})}),Object(Z.jsxs)(w.a,{onClose:this.resetModalData,open:this.state.shouldShowModal,children:[Object(Z.jsx)(F.a,{id:"form-dialog-title",children:this.state.isEdit?"Edit contact details":"Add contact details"}),this.renderDialogContent(),Object(Z.jsxs)(C.a,{children:[Object(Z.jsx)(j.a,{onClick:function(){e.onSavePressed()},size:"small",variant:"text",color:"primary",children:Object(Z.jsx)("span",{className:"actions",children:this.state.isEdit?"UPDATE":"SAVE"})}),Object(Z.jsx)(j.a,{onClick:this.resetModalData,size:"small",variant:"text",color:"secondary",children:Object(Z.jsx)("span",{className:"actions",children:"DISCARD"})})]})]}),Object(Z.jsx)(N.a,{open:this.state.showSnackbar,onClose:this.handleClose,ContentProps:{"aria-describedby":"message-id"},message:Object(Z.jsx)("span",{id:"message-id",children:this.state.snackbarText})}),this.state.isLoading&&Object(Z.jsx)("img",{src:f,alt:"logo",className:"spinner"})]})}}]),a}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(Z.jsx)(q,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[84,1,2]]]);
//# sourceMappingURL=main.800c37a2.chunk.js.map